{"version":3,"file":"preload.mjs","sources":["../electron/preload.ts"],"sourcesContent":["import { ipcRenderer, contextBridge } from 'electron'\n\n// 数据库操作 API 响应类型\ntype ApiResponse<T = unknown> = { success: boolean; data?: T; error?: string }\n\n// 记录类型\ninterface DbRecord {\n  id?: number\n  guestName: string\n  amount: number\n  amountChinese?: string\n  itemDescription?: string\n  paymentType: number\n  remark?: string\n  createTime?: string\n  updateTime?: string\n  isDeleted?: number\n}\n\n// 数据库操作 API\ninterface DatabaseAPI {\n  getAllRecords: () => Promise<ApiResponse<DbRecord[]>>\n  getRecordById: (id: number) => Promise<ApiResponse<DbRecord>>\n  searchRecords: (keyword: string) => Promise<ApiResponse<DbRecord[]>>\n  insertRecord: (record: DbRecord) => Promise<ApiResponse<{ id: number }>>\n  updateRecord: (record: DbRecord) => Promise<ApiResponse>\n  softDeleteRecord: (id: number) => Promise<ApiResponse>\n  getRecordHistory: (recordId: number) => Promise<ApiResponse<any[]>>\n  getAllRecordHistory: () => Promise<ApiResponse<any[]>>\n  getStatistics: () => Promise<ApiResponse<any>>\n  batchInsertRecords: (records: DbRecord[]) => Promise<ApiResponse<{ count: number }>>\n}\n\n// 应用 API 接口\ninterface AppAPI {\n  generatePDF: (data: {\n    records: any[]\n    appName: string\n    exportDate: string\n    theme?: {\n      primary?: string\n      paper?: string\n      textPrimary?: string\n      accent?: string\n    }\n  }) => Promise<ApiResponse<{ filePath: string }>>\n}\n\n// Electron API 接口（新增）\ninterface ElectronAPI {\n  // 打开数据库文件对话框\n  openDatabaseFile: () => Promise<ApiResponse<{ filePath: string }>>\n  // 创建新数据库\n  createNewDatabase: (fileName: string) => Promise<ApiResponse<{ filePath: string }>>\n  // 切换数据库\n  switchDatabase: (filePath: string) => Promise<ApiResponse>\n  // 保存当前数据库\n  saveCurrentDatabase: (fileName: string) => Promise<ApiResponse<{ filePath: string }>>\n  // 获取最近打开的文件列表\n  getRecentDatabases: () => Promise<ApiResponse<{ recentDatabases: { name: string; path: string; lastOpened: string }[] }>>\n  // 删除数据库文件\n  deleteDatabase: (filePath: string) => Promise<ApiResponse>\n  // 打开导入文件对话框（Excel）\n  openImportFile: () => Promise<ApiResponse<{ filePath: string }>>\n  // 解析导入文件\n  parseImportFile: (filePath: string) => Promise<ApiResponse<{ headers: string[]; data: any[][]; totalRows: number }>>\n}\n\n// 只暴露必要的数据库 API，遵循 Electron 安全最佳实践\ncontextBridge.exposeInMainWorld('db', {\n  getAllRecords: () => ipcRenderer.invoke('db:getAllRecords'),\n  getRecordById: (id: number) => ipcRenderer.invoke('db:getRecordById', id),\n  searchRecords: (keyword: string) => ipcRenderer.invoke('db:searchRecords', keyword),\n  insertRecord: (record: DbRecord) => ipcRenderer.invoke('db:insertRecord', record),\n  updateRecord: (record: DbRecord) => ipcRenderer.invoke('db:updateRecord', record),\n  softDeleteRecord: (id: number) => ipcRenderer.invoke('db:softDeleteRecord', id),\n  getRecordHistory: (recordId: number) => ipcRenderer.invoke('db:getRecordHistory', recordId),\n  getAllRecordHistory: () => ipcRenderer.invoke('db:getAllRecordHistory'),\n  getStatistics: () => ipcRenderer.invoke('db:getStatistics'),\n  batchInsertRecords: (records: DbRecord[]) => ipcRenderer.invoke('db:batchInsertRecords', records),\n} as DatabaseAPI)\n\n// 暴露应用 API\ncontextBridge.exposeInMainWorld('app', {\n  generatePDF: (data: Parameters<AppAPI['generatePDF']>[0]) => ipcRenderer.invoke('app:generatePDF', data),\n} as AppAPI)\n\n// 暴露 Electron API（新增）\ncontextBridge.exposeInMainWorld('electronAPI', {\n  openDatabaseFile: () => ipcRenderer.invoke('electron:openDatabaseFile'),\n  createNewDatabase: (fileName: string) => ipcRenderer.invoke('electron:createNewDatabase', fileName),\n  switchDatabase: (filePath: string) => ipcRenderer.invoke('electron:switchDatabase', filePath),\n  saveCurrentDatabase: (fileName: string) => ipcRenderer.invoke('electron:saveCurrentDatabase', fileName),\n  getRecentDatabases: () => ipcRenderer.invoke('electron:getRecentDatabases'),\n  deleteDatabase: (filePath: string) => ipcRenderer.invoke('electron:deleteDatabase', filePath),\n  openImportFile: () => ipcRenderer.invoke('electron:openImportFile'),\n  parseImportFile: (filePath: string) => ipcRenderer.invoke('electron:parseImportFile', filePath),\n} as ElectronAPI)\n\n// 类型声明已移至 src/types/database.ts\n"],"names":["contextBridge","ipcRenderer","id","keyword","record","recordId","records","data","fileName","filePath"],"mappings":"yCAqEAA,EAAAA,cAAc,kBAAkB,KAAM,CACpC,cAAe,IAAMC,EAAAA,YAAY,OAAO,kBAAkB,EAC1D,cAAgBC,GAAeD,EAAAA,YAAY,OAAO,mBAAoBC,CAAE,EACxE,cAAgBC,GAAoBF,EAAAA,YAAY,OAAO,mBAAoBE,CAAO,EAClF,aAAeC,GAAqBH,EAAAA,YAAY,OAAO,kBAAmBG,CAAM,EAChF,aAAeA,GAAqBH,EAAAA,YAAY,OAAO,kBAAmBG,CAAM,EAChF,iBAAmBF,GAAeD,EAAAA,YAAY,OAAO,sBAAuBC,CAAE,EAC9E,iBAAmBG,GAAqBJ,EAAAA,YAAY,OAAO,sBAAuBI,CAAQ,EAC1F,oBAAqB,IAAMJ,EAAAA,YAAY,OAAO,wBAAwB,EACtE,cAAe,IAAMA,EAAAA,YAAY,OAAO,kBAAkB,EAC1D,mBAAqBK,GAAwBL,EAAAA,YAAY,OAAO,wBAAyBK,CAAO,CAClG,CAAgB,EAGhBN,EAAAA,cAAc,kBAAkB,MAAO,CACrC,YAAcO,GAA+CN,EAAAA,YAAY,OAAO,kBAAmBM,CAAI,CACzG,CAAW,EAGXP,EAAAA,cAAc,kBAAkB,cAAe,CAC7C,iBAAkB,IAAMC,EAAAA,YAAY,OAAO,2BAA2B,EACtE,kBAAoBO,GAAqBP,EAAAA,YAAY,OAAO,6BAA8BO,CAAQ,EAClG,eAAiBC,GAAqBR,EAAAA,YAAY,OAAO,0BAA2BQ,CAAQ,EAC5F,oBAAsBD,GAAqBP,EAAAA,YAAY,OAAO,+BAAgCO,CAAQ,EACtG,mBAAoB,IAAMP,EAAAA,YAAY,OAAO,6BAA6B,EAC1E,eAAiBQ,GAAqBR,EAAAA,YAAY,OAAO,0BAA2BQ,CAAQ,EAC5F,eAAgB,IAAMR,EAAAA,YAAY,OAAO,yBAAyB,EAClE,gBAAkBQ,GAAqBR,EAAAA,YAAY,OAAO,2BAA4BQ,CAAQ,CAChG,CAAgB"}