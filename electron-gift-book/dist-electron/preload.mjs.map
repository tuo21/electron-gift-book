{"version":3,"file":"preload.mjs","sources":["../electron/preload.ts"],"sourcesContent":["import { ipcRenderer, contextBridge } from 'electron'\n\n// 数据库操作 API 响应类型\ntype ApiResponse<T = unknown> = { success: boolean; data?: T; error?: string }\n\n// 记录类型\ninterface DbRecord {\n  id?: number\n  guestName: string\n  amount: number\n  amountChinese?: string\n  itemDescription?: string\n  paymentType: number\n  remark?: string\n  createTime?: string\n  updateTime?: string\n  isDeleted?: number\n}\n\n// 数据库操作 API\ninterface DatabaseAPI {\n  getAllRecords: () => Promise<ApiResponse<DbRecord[]>>\n  getRecordById: (id: number) => Promise<ApiResponse<DbRecord>>\n  searchRecords: (keyword: string) => Promise<ApiResponse<DbRecord[]>>\n  insertRecord: (record: DbRecord) => Promise<ApiResponse<{ id: number }>>\n  updateRecord: (record: DbRecord) => Promise<ApiResponse>\n  softDeleteRecord: (id: number) => Promise<ApiResponse>\n  getRecordHistory: (recordId: number) => Promise<ApiResponse<any[]>>\n  getAllRecordHistory: () => Promise<ApiResponse<any[]>>\n  getStatistics: () => Promise<ApiResponse<any>>\n  batchInsertRecords: (records: DbRecord[]) => Promise<ApiResponse<{ count: number }>>\n}\n\n// 应用 API 接口\ninterface AppAPI {\n  generatePDF: (data: {\n    records: any[]\n    appName: string\n    exportDate: string\n    theme?: {\n      primary?: string\n      paper?: string\n      textPrimary?: string\n      accent?: string\n    }\n  }) => Promise<ApiResponse<{ filePath: string }>>\n}\n\n// Electron API 接口（新增）\ninterface ElectronAPI {\n  // 打开数据库文件对话框\n  openDatabaseFile: () => Promise<ApiResponse<{ filePath: string }>>\n  // 创建新数据库\n  createNewDatabase: (fileName: string) => Promise<ApiResponse<{ filePath: string }>>\n  // 切换数据库\n  switchDatabase: (filePath: string) => Promise<ApiResponse>\n  // 保存当前数据库\n  saveCurrentDatabase: (fileName: string) => Promise<ApiResponse<{ filePath: string }>>\n  // 获取最近打开的文件列表\n  getRecentDatabases: () => Promise<ApiResponse<{ recentDatabases: { name: string; path: string; lastOpened: string }[] }>>\n  // 删除数据库文件\n  deleteDatabase: (filePath: string) => Promise<ApiResponse>\n  // 打开导入文件对话框（Excel）\n  openImportFile: () => Promise<ApiResponse<{ filePath: string }>>\n  // 解析导入文件\n  parseImportFile: (filePath: string) => Promise<ApiResponse<{ headers: string[]; data: any[][]; totalRows: number }>>\n}\n\n// 只暴露必要的数据库 API，遵循 Electron 安全最佳实践\ncontextBridge.exposeInMainWorld('db', {\n  getAllRecords: () => ipcRenderer.invoke('db:getAllRecords'),\n  getRecordById: (id: number) => ipcRenderer.invoke('db:getRecordById', id),\n  searchRecords: (keyword: string) => ipcRenderer.invoke('db:searchRecords', keyword),\n  insertRecord: (record: DbRecord) => ipcRenderer.invoke('db:insertRecord', record),\n  updateRecord: (record: DbRecord) => ipcRenderer.invoke('db:updateRecord', record),\n  softDeleteRecord: (id: number) => ipcRenderer.invoke('db:softDeleteRecord', id),\n  getRecordHistory: (recordId: number) => ipcRenderer.invoke('db:getRecordHistory', recordId),\n  getAllRecordHistory: () => ipcRenderer.invoke('db:getAllRecordHistory'),\n  getStatistics: () => ipcRenderer.invoke('db:getStatistics'),\n  batchInsertRecords: (records: DbRecord[]) => ipcRenderer.invoke('db:batchInsertRecords', records),\n} as DatabaseAPI)\n\n// 暴露应用 API\ncontextBridge.exposeInMainWorld('app', {\n  generatePDF: (data: Parameters<AppAPI['generatePDF']>[0]) => ipcRenderer.invoke('app:generatePDF', data),\n} as AppAPI)\n\n// 暴露 Electron API（新增）\ncontextBridge.exposeInMainWorld('electronAPI', {\n  openDatabaseFile: () => ipcRenderer.invoke('electron:openDatabaseFile'),\n  createNewDatabase: (fileName: string) => ipcRenderer.invoke('electron:createNewDatabase', fileName),\n  switchDatabase: (filePath: string) => ipcRenderer.invoke('electron:switchDatabase', filePath),\n  saveCurrentDatabase: (fileName: string) => ipcRenderer.invoke('electron:saveCurrentDatabase', fileName),\n  getRecentDatabases: () => ipcRenderer.invoke('electron:getRecentDatabases'),\n  deleteDatabase: (filePath: string) => ipcRenderer.invoke('electron:deleteDatabase', filePath),\n  openImportFile: () => ipcRenderer.invoke('electron:openImportFile'),\n  parseImportFile: (filePath: string) => ipcRenderer.invoke('electron:parseImportFile', filePath),\n} as ElectronAPI)\n\n// 类型声明已移至 src/types/database.ts\n"],"names":["contextBridge","ipcRenderer"],"mappings":";;AAqEAA,SAAAA,cAAc,kBAAkB,MAAM;AAAA,EACpC,eAAe,MAAMC,SAAAA,YAAY,OAAO,kBAAkB;AAAA,EAC1D,eAAe,CAAC,OAAeA,SAAAA,YAAY,OAAO,oBAAoB,EAAE;AAAA,EACxE,eAAe,CAAC,YAAoBA,SAAAA,YAAY,OAAO,oBAAoB,OAAO;AAAA,EAClF,cAAc,CAAC,WAAqBA,SAAAA,YAAY,OAAO,mBAAmB,MAAM;AAAA,EAChF,cAAc,CAAC,WAAqBA,SAAAA,YAAY,OAAO,mBAAmB,MAAM;AAAA,EAChF,kBAAkB,CAAC,OAAeA,SAAAA,YAAY,OAAO,uBAAuB,EAAE;AAAA,EAC9E,kBAAkB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,uBAAuB,QAAQ;AAAA,EAC1F,qBAAqB,MAAMA,SAAAA,YAAY,OAAO,wBAAwB;AAAA,EACtE,eAAe,MAAMA,SAAAA,YAAY,OAAO,kBAAkB;AAAA,EAC1D,oBAAoB,CAAC,YAAwBA,SAAAA,YAAY,OAAO,yBAAyB,OAAO;AAClG,CAAgB;AAGhBD,SAAAA,cAAc,kBAAkB,OAAO;AAAA,EACrC,aAAa,CAAC,SAA+CC,SAAAA,YAAY,OAAO,mBAAmB,IAAI;AACzG,CAAW;AAGXD,SAAAA,cAAc,kBAAkB,eAAe;AAAA,EAC7C,kBAAkB,MAAMC,SAAAA,YAAY,OAAO,2BAA2B;AAAA,EACtE,mBAAmB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,8BAA8B,QAAQ;AAAA,EAClG,gBAAgB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,2BAA2B,QAAQ;AAAA,EAC5F,qBAAqB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,gCAAgC,QAAQ;AAAA,EACtG,oBAAoB,MAAMA,SAAAA,YAAY,OAAO,6BAA6B;AAAA,EAC1E,gBAAgB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,2BAA2B,QAAQ;AAAA,EAC5F,gBAAgB,MAAMA,SAAAA,YAAY,OAAO,yBAAyB;AAAA,EAClE,iBAAiB,CAAC,aAAqBA,SAAAA,YAAY,OAAO,4BAA4B,QAAQ;AAChG,CAAgB;"}