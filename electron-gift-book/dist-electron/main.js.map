{"version":3,"file":"main.js","sources":["../electron/database.ts","../electron/main.ts"],"sourcesContent":["import Database from 'better-sqlite3'\r\nimport path from 'node:path'\r\nimport { app } from 'electron'\r\n\r\n// Êï∞ÊçÆÂ∫ìËøûÊé•ÂÆû‰æã\r\nlet db: Database.Database | null = null\r\n\r\n// Ëé∑ÂèñÊï∞ÊçÆÂ∫ìÊñá‰ª∂Ë∑ØÂæÑ\r\nfunction getDbPath(): string {\r\n  const userDataPath = app.getPath('userData')\r\n  return path.join(userDataPath, 'gift-book.db')\r\n}\r\n\r\n// ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\nexport function initDatabase(): Database.Database {\r\n  if (db) return db\r\n\r\n  const dbPath = getDbPath()\r\n  console.log('Database path:', dbPath)\r\n\r\n  db = new Database(dbPath)\r\n\r\n  // ÂêØÁî®Â§ñÈîÆÁ∫¶Êùü\r\n  db.pragma('journal_mode = WAL')\r\n  db.pragma('foreign_keys = ON')\r\n\r\n  // ÂàõÂª∫‰∏ªËÆ∞ÂΩïË°®\r\n  db.exec(`\r\n    CREATE TABLE IF NOT EXISTS Records (\r\n      Id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      GuestName TEXT NOT NULL,\r\n      Amount DECIMAL(10, 2) NOT NULL DEFAULT 0,\r\n      AmountChinese TEXT,\r\n      ItemDescription TEXT,\r\n      PaymentType INTEGER DEFAULT 0,\r\n      Remark TEXT,\r\n      CreateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      IsDeleted INTEGER DEFAULT 0\r\n    )\r\n  `)\r\n\r\n  // ÂàõÂª∫‰øÆÊîπÂéÜÂè≤Ë°®\r\n  db.exec(`\r\n    CREATE TABLE IF NOT EXISTS Records_History (\r\n      HistoryId INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      RecordId INTEGER NOT NULL,\r\n      GuestName TEXT NOT NULL,\r\n      Amount DECIMAL(10, 2),\r\n      ItemDescription TEXT,\r\n      PaymentType INTEGER,\r\n      Remark TEXT,\r\n      UpdateBy TEXT DEFAULT 'System',\r\n      UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      ChangeDesc TEXT,\r\n      FOREIGN KEY (RecordId) REFERENCES Records(Id)\r\n    )\r\n  `)\r\n\r\n  // ÂàõÂª∫Á¥¢Âºï‰ª•ÊèêÈ´òÊü•ËØ¢ÊÄßËÉΩ\r\n  db.exec(`\r\n    CREATE INDEX IF NOT EXISTS idx_records_guestname ON Records(GuestName);\r\n    CREATE INDEX IF NOT EXISTS idx_records_isdeleted ON Records(IsDeleted);\r\n    CREATE INDEX IF NOT EXISTS idx_history_recordid ON Records_History(RecordId);\r\n  `)\r\n\r\n  console.log('Database initialized successfully')\r\n  return db\r\n}\r\n\r\n// Ëé∑ÂèñÊï∞ÊçÆÂ∫ìÂÆû‰æã\r\nexport function getDatabase(): Database.Database {\r\n  if (!db) {\r\n    throw new Error('Database not initialized. Call initDatabase() first.')\r\n  }\r\n  return db\r\n}\r\n\r\n// ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•\r\nexport function closeDatabase(): void {\r\n  if (db) {\r\n    db.close()\r\n    db = null\r\n    console.log('Database connection closed')\r\n  }\r\n}\r\n\r\n// ËÆ∞ÂΩïÊìç‰ΩúÁ±ªÂûã\r\nexport interface Record {\r\n  Id?: number\r\n  GuestName: string\r\n  Amount: number\r\n  AmountChinese?: string\r\n  ItemDescription?: string\r\n  PaymentType: number\r\n  Remark?: string\r\n  CreateTime?: string\r\n  UpdateTime?: string\r\n  IsDeleted?: number\r\n}\r\n\r\nexport interface RecordHistory {\r\n  HistoryId?: number\r\n  RecordId: number\r\n  GuestName: string\r\n  Amount?: number\r\n  ItemDescription?: string\r\n  PaymentType?: number\r\n  Remark?: string\r\n  UpdateBy?: string\r\n  UpdateTime?: string\r\n  ChangeDesc?: string\r\n}\r\n\r\n// ÊèíÂÖ•ËÆ∞ÂΩï\r\nexport function insertRecord(record: Record): number {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    INSERT INTO Records (GuestName, Amount, AmountChinese, ItemDescription, PaymentType, Remark)\r\n    VALUES (@GuestName, @Amount, @AmountChinese, @ItemDescription, @PaymentType, @Remark)\r\n  `)\r\n  const result = stmt.run(record)\r\n  return result.lastInsertRowid as number\r\n}\r\n\r\n// Êõ¥Êñ∞ËÆ∞ÂΩï\r\nexport function updateRecord(record: Record): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    UPDATE Records \r\n    SET GuestName = @GuestName, \r\n        Amount = @Amount, \r\n        AmountChinese = @AmountChinese,\r\n        ItemDescription = @ItemDescription, \r\n        PaymentType = @PaymentType, \r\n        Remark = @Remark,\r\n        UpdateTime = CURRENT_TIMESTAMP\r\n    WHERE Id = @Id\r\n  `)\r\n  stmt.run(record)\r\n}\r\n\r\n// ËΩØÂà†Èô§ËÆ∞ÂΩï\r\nexport function softDeleteRecord(id: number): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    UPDATE Records SET IsDeleted = 1, UpdateTime = CURRENT_TIMESTAMP WHERE Id = ?\r\n  `)\r\n  stmt.run(id)\r\n}\r\n\r\n// Ëé∑ÂèñÊâÄÊúâÊú™Âà†Èô§ÁöÑËÆ∞ÂΩï\r\nexport function getAllRecords(): Record[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records WHERE IsDeleted = 0 ORDER BY CreateTime DESC\r\n  `)\r\n  return stmt.all() as Record[]\r\n}\r\n\r\n// Ê†πÊçÆIDËé∑ÂèñËÆ∞ÂΩï\r\nexport function getRecordById(id: number): Record | undefined {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records WHERE Id = ? AND IsDeleted = 0\r\n  `)\r\n  return stmt.get(id) as Record | undefined\r\n}\r\n\r\n// ÊêúÁ¥¢ËÆ∞ÂΩï\r\nexport function searchRecords(keyword: string): Record[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records \r\n    WHERE IsDeleted = 0 AND (GuestName LIKE ? OR Remark LIKE ? OR ItemDescription LIKE ?)\r\n    ORDER BY CreateTime DESC\r\n  `)\r\n  const likeKeyword = `%${keyword}%`\r\n  return stmt.all(likeKeyword, likeKeyword, likeKeyword) as Record[]\r\n}\r\n\r\n// ÊèíÂÖ•ÂéÜÂè≤ËÆ∞ÂΩï\r\nexport function insertHistory(history: RecordHistory): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    INSERT INTO Records_History (RecordId, GuestName, Amount, ItemDescription, PaymentType, Remark, UpdateBy, ChangeDesc)\r\n    VALUES (@RecordId, @GuestName, @Amount, @ItemDescription, @PaymentType, @Remark, @UpdateBy, @ChangeDesc)\r\n  `)\r\n  stmt.run(history)\r\n}\r\n\r\n// Ëé∑ÂèñËÆ∞ÂΩïÁöÑÂéÜÂè≤\r\nexport function getRecordHistory(recordId: number): RecordHistory[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records_History WHERE RecordId = ? ORDER BY UpdateTime DESC\r\n  `)\r\n  return stmt.all(recordId) as RecordHistory[]\r\n}\r\n\r\n// Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ\r\nexport interface Statistics {\r\n  totalCount: number\r\n  totalAmount: number\r\n  cashAmount: number\r\n  wechatAmount: number\r\n  internalAmount: number\r\n}\r\n\r\nexport function getStatistics(): Statistics {\r\n  const db = getDatabase()\r\n  \r\n  const totalStmt = db.prepare(`\r\n    SELECT COUNT(*) as count, COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0\r\n  `)\r\n  const totalResult = totalStmt.get() as { count: number; total: number }\r\n\r\n  const cashStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 0\r\n  `)\r\n  const cashResult = cashStmt.get() as { total: number }\r\n\r\n  const wechatStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 1\r\n  `)\r\n  const wechatResult = wechatStmt.get() as { total: number }\r\n\r\n  const internalStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 2\r\n  `)\r\n  const internalResult = internalStmt.get() as { total: number }\r\n\r\n  return {\r\n    totalCount: totalResult.count,\r\n    totalAmount: totalResult.total,\r\n    cashAmount: cashResult.total,\r\n    wechatAmount: wechatResult.total,\r\n    internalAmount: internalResult.total\r\n  }\r\n}\r\n","import { app, BrowserWindow, ipcMain } from 'electron'\r\nimport path from 'node:path'\r\nimport { fileURLToPath } from 'node:url'\r\nimport {\r\n  initDatabase,\r\n  closeDatabase,\r\n  insertRecord,\r\n  updateRecord,\r\n  softDeleteRecord,\r\n  getAllRecords,\r\n  getRecordById,\r\n  searchRecords,\r\n  insertHistory,\r\n  getRecordHistory,\r\n  getStatistics,\r\n  type Record,\r\n  type RecordHistory\r\n} from './database'\r\n\r\n// Ëé∑ÂèñÂΩìÂâçÊñá‰ª∂ÁõÆÂΩïÔºàES Ê®°ÂùóÂÖºÂÆπÔºâ\r\nconst __filename = fileURLToPath(import.meta.url)\r\nconst __dirname = path.dirname(__filename)\r\n\r\n// The built directory structure\r\n//\r\n// ‚îú‚îÄ‚î¨‚îÄ‚î¨ dist\r\n// ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ index.html\r\n// ‚îÇ ‚îÇ\r\n// ‚îÇ ‚îú‚îÄ‚î¨ dist-electron\r\n// ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ main.js\r\n// ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ preload.mjs\r\n// ‚îÇ\r\nprocess.env.APP_ROOT = path.join(__dirname, '..')\r\n\r\n// üöß Use ['ENV_NAME'] avoid vite:define plugin - Vite@2.x\r\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL']\r\nexport const MAIN_DIST = path.join(process.env.APP_ROOT, 'dist-electron')\r\nexport const RENDERER_DIST = path.join(process.env.APP_ROOT, 'dist')\r\n\r\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL ? path.join(process.env.APP_ROOT, 'public') : RENDERER_DIST\r\n\r\nlet win: BrowserWindow | null\r\n\r\nfunction createWindow() {\r\n  win = new BrowserWindow({\r\n    icon: path.join(process.env.VITE_PUBLIC, 'electron-vite.svg'),\r\n    width: 1400,\r\n    height: 900,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      contextIsolation: true,\r\n      nodeIntegration: false\r\n    },\r\n  })\r\n\r\n  // Test active push message to Renderer-process.\r\n  win.webContents.on('did-finish-load', () => {\r\n    win?.webContents.send('main-process-message', (new Date).toLocaleString())\r\n  })\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    win.loadURL(VITE_DEV_SERVER_URL)\r\n  } else {\r\n    // win.loadFile('dist/index.html')\r\n    win.loadFile(path.join(RENDERER_DIST, 'index.html'))\r\n  }\r\n}\r\n\r\n// ËÆæÁΩÆ IPC Â§ÑÁêÜÂô®\r\nfunction setupIpcHandlers() {\r\n  // Ëé∑ÂèñÊâÄÊúâËÆ∞ÂΩï\r\n  ipcMain.handle('db:getAllRecords', () => {\r\n    try {\r\n      return { success: true, data: getAllRecords() }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ê†πÊçÆIDËé∑ÂèñËÆ∞ÂΩï\r\n  ipcMain.handle('db:getRecordById', (_, id: number) => {\r\n    try {\r\n      return { success: true, data: getRecordById(id) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÊêúÁ¥¢ËÆ∞ÂΩï\r\n  ipcMain.handle('db:searchRecords', (_, keyword: string) => {\r\n    try {\r\n      return { success: true, data: searchRecords(keyword) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÊèíÂÖ•ËÆ∞ÂΩï\r\n  ipcMain.handle('db:insertRecord', (_, record: Record) => {\r\n    try {\r\n      const id = insertRecord(record)\r\n      return { success: true, data: { id } }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Êõ¥Êñ∞ËÆ∞ÂΩï\r\n  ipcMain.handle('db:updateRecord', (_, record: Record) => {\r\n    try {\r\n      // ÂÖàËé∑ÂèñÊóßËÆ∞ÂΩïÁî®‰∫éÂéÜÂè≤ËÆ∞ÂΩï\r\n      const oldRecord = getRecordById(record.Id!)\r\n      if (oldRecord) {\r\n        insertHistory({\r\n          RecordId: record.Id!,\r\n          GuestName: oldRecord.GuestName,\r\n          Amount: oldRecord.Amount,\r\n          ItemDescription: oldRecord.ItemDescription,\r\n          PaymentType: oldRecord.PaymentType,\r\n          Remark: oldRecord.Remark,\r\n          ChangeDesc: 'Êõ¥Êñ∞ËÆ∞ÂΩï'\r\n        })\r\n      }\r\n      updateRecord(record)\r\n      return { success: true }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ËΩØÂà†Èô§ËÆ∞ÂΩï\r\n  ipcMain.handle('db:softDeleteRecord', (_, id: number) => {\r\n    try {\r\n      // ÂÖàËé∑ÂèñÊóßËÆ∞ÂΩïÁî®‰∫éÂéÜÂè≤ËÆ∞ÂΩï\r\n      const oldRecord = getRecordById(id)\r\n      if (oldRecord) {\r\n        insertHistory({\r\n          RecordId: id,\r\n          GuestName: oldRecord.GuestName,\r\n          Amount: oldRecord.Amount,\r\n          ItemDescription: oldRecord.ItemDescription,\r\n          PaymentType: oldRecord.PaymentType,\r\n          Remark: oldRecord.Remark,\r\n          ChangeDesc: 'Âà†Èô§ËÆ∞ÂΩï'\r\n        })\r\n      }\r\n      softDeleteRecord(id)\r\n      return { success: true }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñËÆ∞ÂΩïÂéÜÂè≤\r\n  ipcMain.handle('db:getRecordHistory', (_, recordId: number) => {\r\n    try {\r\n      return { success: true, data: getRecordHistory(recordId) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ\r\n  ipcMain.handle('db:getStatistics', () => {\r\n    try {\r\n      return { success: true, data: getStatistics() }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n}\r\n\r\n// Quit when all windows are closed, except on macOS. There, it's common\r\n// for applications and their menu bar to stay active until the user quits\r\n// explicitly with Cmd + Q.\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') {\r\n    closeDatabase()\r\n    app.quit()\r\n    win = null\r\n  }\r\n})\r\n\r\napp.on('activate', () => {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (BrowserWindow.getAllWindows().length === 0) {\r\n    createWindow()\r\n  }\r\n})\r\n\r\napp.whenReady().then(() => {\r\n  try {\r\n    // ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\n    initDatabase()\r\n    console.log('Database initialized successfully')\r\n  } catch (error) {\r\n    console.error('Failed to initialize database:', error)\r\n  }\r\n  // ËÆæÁΩÆ IPC Â§ÑÁêÜÂô®\r\n  setupIpcHandlers()\r\n  // ÂàõÂª∫Á™óÂè£\r\n  createWindow()\r\n})\r\n"],"names":["db","__filename","__dirname"],"mappings":"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"}