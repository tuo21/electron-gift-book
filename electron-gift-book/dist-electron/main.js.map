{"version":3,"file":"main.js","sources":["../electron/database.ts","../electron/main.ts"],"sourcesContent":["import Database from 'better-sqlite3'\r\nimport path from 'node:path'\r\nimport fs from 'node:fs'\r\n\r\n// Êï∞ÊçÆÂ∫ìËøûÊé•ÂÆû‰æã\r\nlet db: Database.Database | null = null\r\n\r\n// Ëé∑ÂèñÊï∞ÊçÆÂ∫ìÊñá‰ª∂Ë∑ØÂæÑ\r\nfunction getDbPath(): string {\r\n  // ‰ΩøÁî®È°πÁõÆÁõÆÂΩï‰∏ãÁöÑ data Êñá‰ª∂Â§πÂ≠òÂÇ®Êï∞ÊçÆÂ∫ì\r\n  const dbDir = path.join(process.cwd(), 'data')\r\n  if (!fs.existsSync(dbDir)) {\r\n    fs.mkdirSync(dbDir, { recursive: true })\r\n  }\r\n  return path.join(dbDir, 'gift-book.db')\r\n}\r\n\r\n// ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\nexport function initDatabase(): Database.Database {\r\n  if (db) return db\r\n\r\n  const dbPath = getDbPath()\r\n  console.log('Database path:', dbPath)\r\n\r\n  db = new Database(dbPath)\r\n\r\n  // ÂêØÁî®Â§ñÈîÆÁ∫¶Êùü\r\n  db.pragma('foreign_keys = ON')\r\n\r\n  // ÂàõÂª∫‰∏ªËÆ∞ÂΩïË°®\r\n  db.exec(`\r\n    CREATE TABLE IF NOT EXISTS Records (\r\n      Id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      GuestName TEXT NOT NULL,\r\n      Amount DECIMAL(10, 2) NOT NULL DEFAULT 0,\r\n      AmountChinese TEXT,\r\n      ItemDescription TEXT,\r\n      PaymentType INTEGER DEFAULT 0,\r\n      Remark TEXT,\r\n      CreateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      IsDeleted INTEGER DEFAULT 0\r\n    )\r\n  `)\r\n\r\n  // ÂàõÂª∫‰øÆÊîπÂéÜÂè≤Ë°®\r\n  db.exec(`\r\n    CREATE TABLE IF NOT EXISTS Records_History (\r\n      HistoryId INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      RecordId INTEGER NOT NULL,\r\n      GuestName TEXT NOT NULL,\r\n      Amount DECIMAL(10, 2),\r\n      ItemDescription TEXT,\r\n      PaymentType INTEGER,\r\n      Remark TEXT,\r\n      NewGuestName TEXT,\r\n      NewAmount DECIMAL(10, 2),\r\n      NewItemDescription TEXT,\r\n      NewPaymentType INTEGER,\r\n      NewRemark TEXT,\r\n      OperationType TEXT DEFAULT 'UPDATE',\r\n      UpdateBy TEXT DEFAULT 'System',\r\n      UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      ChangeDesc TEXT,\r\n      FOREIGN KEY (RecordId) REFERENCES Records(Id)\r\n    )\r\n  `)\r\n\r\n  // ÂàõÂª∫Á¥¢Âºï‰ª•ÊèêÈ´òÊü•ËØ¢ÊÄßËÉΩ\r\n  db.exec(`\r\n    CREATE INDEX IF NOT EXISTS idx_records_guestname ON Records(GuestName);\r\n    CREATE INDEX IF NOT EXISTS idx_records_isdeleted ON Records(IsDeleted);\r\n    CREATE INDEX IF NOT EXISTS idx_history_recordid ON Records_History(RecordId);\r\n  `)\r\n\r\n  // Êï∞ÊçÆÂ∫ìËøÅÁßªÔºöÊ∑ªÂä†Êñ∞ÂàóÂà∞ Records_History Ë°®\r\n  migrateHistoryTable(db)\r\n\r\n  console.log('Database initialized successfully')\r\n  return db\r\n}\r\n\r\n// Êï∞ÊçÆÂ∫ìËøÅÁßªÔºö‰∏∫ Records_History Ë°®Ê∑ªÂä†Êñ∞Âàó\r\nfunction migrateHistoryTable(db: Database.Database): void {\r\n  try {\r\n    // Ê£ÄÊü•Âπ∂Ê∑ªÂä†Êñ∞Âàó\r\n    const columns = db.prepare(`PRAGMA table_info(Records_History)`).all() as { name: string }[]\r\n    const columnNames = columns.map(col => col.name)\r\n\r\n    if (!columnNames.includes('NewGuestName')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN NewGuestName TEXT`)\r\n      console.log('Migration: Added NewGuestName column')\r\n    }\r\n    if (!columnNames.includes('NewAmount')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN NewAmount DECIMAL(10, 2)`)\r\n      console.log('Migration: Added NewAmount column')\r\n    }\r\n    if (!columnNames.includes('NewItemDescription')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN NewItemDescription TEXT`)\r\n      console.log('Migration: Added NewItemDescription column')\r\n    }\r\n    if (!columnNames.includes('NewPaymentType')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN NewPaymentType INTEGER`)\r\n      console.log('Migration: Added NewPaymentType column')\r\n    }\r\n    if (!columnNames.includes('NewRemark')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN NewRemark TEXT`)\r\n      console.log('Migration: Added NewRemark column')\r\n    }\r\n    if (!columnNames.includes('OperationType')) {\r\n      db.exec(`ALTER TABLE Records_History ADD COLUMN OperationType TEXT DEFAULT 'UPDATE'`)\r\n      console.log('Migration: Added OperationType column')\r\n    }\r\n  } catch (error) {\r\n    console.error('Migration failed:', error)\r\n  }\r\n}\r\n\r\n// Ëé∑ÂèñÊï∞ÊçÆÂ∫ìÂÆû‰æã\r\nexport function getDatabase(): Database.Database {\r\n  if (!db) {\r\n    throw new Error('Database not initialized. Call initDatabase() first.')\r\n  }\r\n  return db\r\n}\r\n\r\n// ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•\r\nexport function closeDatabase(): void {\r\n  if (db) {\r\n    db.close()\r\n    db = null\r\n    console.log('Database connection closed')\r\n  }\r\n}\r\n\r\n// ËÆ∞ÂΩïÊìç‰ΩúÁ±ªÂûã\r\nexport interface Record {\r\n  Id?: number\r\n  GuestName: string\r\n  Amount: number\r\n  AmountChinese?: string\r\n  ItemDescription?: string\r\n  PaymentType: number\r\n  Remark?: string\r\n  CreateTime?: string\r\n  UpdateTime?: string\r\n  IsDeleted?: number\r\n}\r\n\r\nexport interface RecordHistory {\r\n  HistoryId?: number\r\n  RecordId: number\r\n  GuestName: string\r\n  Amount?: number\r\n  ItemDescription?: string\r\n  PaymentType?: number\r\n  Remark?: string\r\n  NewGuestName?: string\r\n  NewAmount?: number\r\n  NewItemDescription?: string\r\n  NewPaymentType?: number\r\n  NewRemark?: string\r\n  OperationType?: string\r\n  UpdateBy?: string\r\n  UpdateTime?: string\r\n  ChangeDesc?: string\r\n}\r\n\r\n// ÊèíÂÖ•ËÆ∞ÂΩï\r\nexport function insertRecord(record: Record): number {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    INSERT INTO Records (GuestName, Amount, AmountChinese, ItemDescription, PaymentType, Remark)\r\n    VALUES (@GuestName, @Amount, @AmountChinese, @ItemDescription, @PaymentType, @Remark)\r\n  `)\r\n  const result = stmt.run(record)\r\n  return result.lastInsertRowid as number\r\n}\r\n\r\n// Êõ¥Êñ∞ËÆ∞ÂΩï\r\nexport function updateRecord(record: Record): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    UPDATE Records \r\n    SET GuestName = @GuestName, \r\n        Amount = @Amount, \r\n        AmountChinese = @AmountChinese,\r\n        ItemDescription = @ItemDescription, \r\n        PaymentType = @PaymentType, \r\n        Remark = @Remark,\r\n        UpdateTime = CURRENT_TIMESTAMP\r\n    WHERE Id = @Id\r\n  `)\r\n  stmt.run(record)\r\n}\r\n\r\n// ËΩØÂà†Èô§ËÆ∞ÂΩï\r\nexport function softDeleteRecord(id: number): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    UPDATE Records SET IsDeleted = 1, UpdateTime = CURRENT_TIMESTAMP WHERE Id = ?\r\n  `)\r\n  stmt.run(id)\r\n}\r\n\r\n// Ëé∑ÂèñÊâÄÊúâÊú™Âà†Èô§ÁöÑËÆ∞ÂΩï\r\nexport function getAllRecords(): Record[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records WHERE IsDeleted = 0 ORDER BY CreateTime DESC\r\n  `)\r\n  return stmt.all() as Record[]\r\n}\r\n\r\n// Ê†πÊçÆIDËé∑ÂèñËÆ∞ÂΩï\r\nexport function getRecordById(id: number): Record | undefined {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records WHERE Id = ? AND IsDeleted = 0\r\n  `)\r\n  return stmt.get(id) as Record | undefined\r\n}\r\n\r\n// ÊêúÁ¥¢ËÆ∞ÂΩï\r\nexport function searchRecords(keyword: string): Record[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records \r\n    WHERE IsDeleted = 0 AND (GuestName LIKE ? OR Remark LIKE ? OR ItemDescription LIKE ?)\r\n    ORDER BY CreateTime DESC\r\n  `)\r\n  const likeKeyword = `%${keyword}%`\r\n  return stmt.all(likeKeyword, likeKeyword, likeKeyword) as Record[]\r\n}\r\n\r\n// ÊèíÂÖ•ÂéÜÂè≤ËÆ∞ÂΩï\r\nexport function insertHistory(history: RecordHistory): void {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    INSERT INTO Records_History (\r\n      RecordId, GuestName, Amount, ItemDescription, PaymentType, Remark,\r\n      NewGuestName, NewAmount, NewItemDescription, NewPaymentType, NewRemark,\r\n      OperationType, UpdateBy, ChangeDesc\r\n    )\r\n    VALUES (\r\n      @RecordId, @GuestName, @Amount, @ItemDescription, @PaymentType, @Remark,\r\n      @NewGuestName, @NewAmount, @NewItemDescription, @NewPaymentType, @NewRemark,\r\n      @OperationType, @UpdateBy, @ChangeDesc\r\n    )\r\n  `)\r\n  stmt.run(history)\r\n}\r\n\r\n// Ëé∑ÂèñËÆ∞ÂΩïÁöÑÂéÜÂè≤\r\nexport function getRecordHistory(recordId: number): RecordHistory[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT * FROM Records_History WHERE RecordId = ? ORDER BY UpdateTime DESC\r\n  `)\r\n  return stmt.all(recordId) as RecordHistory[]\r\n}\r\n\r\n// Ëé∑ÂèñÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÔºàÁî®‰∫é‰øÆÊîπËÆ∞ÂΩïÂºπÁ™óÔºâ- Âè™ËøîÂõûUPDATEÂíåDELETEÁ±ªÂûãÁöÑËÆ∞ÂΩï\r\nexport function getAllRecordHistory(): RecordHistory[] {\r\n  const db = getDatabase()\r\n  const stmt = db.prepare(`\r\n    SELECT \r\n      h.HistoryId as historyId,\r\n      h.RecordId as recordId,\r\n      h.GuestName as guestName,\r\n      h.Amount as amount,\r\n      h.ItemDescription as itemDescription,\r\n      h.PaymentType as paymentType,\r\n      h.Remark as remark,\r\n      h.NewGuestName as newGuestName,\r\n      h.NewAmount as newAmount,\r\n      h.NewItemDescription as newItemDescription,\r\n      h.NewPaymentType as newPaymentType,\r\n      h.NewRemark as newRemark,\r\n      h.OperationType as operationType,\r\n      h.UpdateBy as updateBy,\r\n      h.UpdateTime as updateTime,\r\n      h.ChangeDesc as changeDesc\r\n    FROM Records_History h\r\n    WHERE h.OperationType IN ('UPDATE', 'DELETE')\r\n    ORDER BY h.UpdateTime DESC\r\n  `)\r\n  return stmt.all() as RecordHistory[]\r\n}\r\n\r\n// Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ\r\nexport interface Statistics {\r\n  totalCount: number\r\n  totalAmount: number\r\n  cashAmount: number\r\n  wechatAmount: number\r\n  internalAmount: number\r\n}\r\n\r\nexport function getStatistics(): Statistics {\r\n  const db = getDatabase()\r\n  \r\n  const totalStmt = db.prepare(`\r\n    SELECT COUNT(*) as count, COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0\r\n  `)\r\n  const totalResult = totalStmt.get() as { count: number; total: number }\r\n\r\n  const cashStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 0\r\n  `)\r\n  const cashResult = cashStmt.get() as { total: number }\r\n\r\n  const wechatStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 1\r\n  `)\r\n  const wechatResult = wechatStmt.get() as { total: number }\r\n\r\n  const internalStmt = db.prepare(`\r\n    SELECT COALESCE(SUM(Amount), 0) as total \r\n    FROM Records \r\n    WHERE IsDeleted = 0 AND PaymentType = 2\r\n  `)\r\n  const internalResult = internalStmt.get() as { total: number }\r\n\r\n  return {\r\n    totalCount: totalResult.count,\r\n    totalAmount: totalResult.total,\r\n    cashAmount: cashResult.total,\r\n    wechatAmount: wechatResult.total,\r\n    internalAmount: internalResult.total\r\n  }\r\n}\r\n","import { app, BrowserWindow, ipcMain, dialog } from 'electron'\r\nimport path from 'node:path'\r\nimport { fileURLToPath } from 'node:url'\r\nimport fs from 'node:fs'\r\nimport {\r\n  initDatabase,\r\n  closeDatabase,\r\n  getDatabase,\r\n  insertRecord,\r\n  updateRecord,\r\n  softDeleteRecord,\r\n  getAllRecords,\r\n  getRecordById,\r\n  searchRecords,\r\n  insertHistory,\r\n  getRecordHistory,\r\n  getAllRecordHistory,\r\n  getStatistics,\r\n  type Record\r\n} from './database'\r\n\r\n// Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÁÆ°ÁêÜ\r\nlet currentDbPath: string = ''\r\nconst dataDir = path.join(process.cwd(), 'data')\r\n\r\n// Á°Æ‰øùÊï∞ÊçÆÁõÆÂΩïÂ≠òÂú®\r\nif (!fs.existsSync(dataDir)) {\r\n  fs.mkdirSync(dataDir, { recursive: true })\r\n}\r\n\r\n// Ëé∑ÂèñÂΩìÂâçÊñá‰ª∂ÁõÆÂΩïÔºàES Ê®°ÂùóÂÖºÂÆπÔºâ\r\nconst __filename = fileURLToPath(import.meta.url)\r\nconst __dirname = path.dirname(__filename)\r\n\r\n// The built directory structure\r\n//\r\n// ‚îú‚îÄ‚î¨‚îÄ‚î¨ dist\r\n// ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ index.html\r\n// ‚îÇ ‚îÇ\r\n// ‚îÇ ‚îú‚îÄ‚î¨ dist-electron\r\n// ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ main.js\r\n// ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ preload.mjs\r\n// ‚îÇ\r\nprocess.env.APP_ROOT = path.join(__dirname, '..')\r\n\r\n// üöß Use ['ENV_NAME'] avoid vite:define plugin - Vite@2.x\r\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL']\r\nexport const MAIN_DIST = path.join(process.env.APP_ROOT, 'dist-electron')\r\nexport const RENDERER_DIST = path.join(process.env.APP_ROOT, 'dist')\r\n\r\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL ? path.join(process.env.APP_ROOT, 'public') : RENDERER_DIST\r\n\r\nlet win: BrowserWindow | null\r\n\r\nfunction createWindow() {\r\n  win = new BrowserWindow({\r\n    icon: path.join(process.env.VITE_PUBLIC, 'images', 'logo.png'),\r\n    width: 1445,\r\n    height: 950,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      contextIsolation: true,\r\n      nodeIntegration: false\r\n    },\r\n  })\r\n\r\n  // ÈöêËóèËèúÂçïÊ†è\r\n  win.removeMenu()\r\n\r\n  // Test active push message to Renderer-process.\r\n  win.webContents.on('did-finish-load', () => {\r\n    win?.webContents.send('main-process-message', (new Date).toLocaleString())\r\n  })\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    win.loadURL(VITE_DEV_SERVER_URL).catch(error => {\r\n      console.error('Failed to load URL:', error)\r\n    })\r\n  } else {\r\n    // win.loadFile('dist/index.html')\r\n    win.loadFile(path.join(RENDERER_DIST, 'index.html')).catch(error => {\r\n      console.error('Failed to load file:', error)\r\n    })\r\n  }\r\n}\r\n\r\n// ËÆæÁΩÆ IPC Â§ÑÁêÜÂô®\r\nfunction setupIpcHandlers() {\r\n  // Ëé∑ÂèñÊâÄÊúâËÆ∞ÂΩï\r\n  ipcMain.handle('db:getAllRecords', () => {\r\n    try {\r\n      return { success: true, data: getAllRecords() }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ê†πÊçÆIDËé∑ÂèñËÆ∞ÂΩï\r\n  ipcMain.handle('db:getRecordById', (_, id: number) => {\r\n    try {\r\n      return { success: true, data: getRecordById(id) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÊêúÁ¥¢ËÆ∞ÂΩï\r\n  ipcMain.handle('db:searchRecords', (_, keyword: string) => {\r\n    try {\r\n      return { success: true, data: searchRecords(keyword) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÊèíÂÖ•ËÆ∞ÂΩï\r\n  ipcMain.handle('db:insertRecord', (_, record: Record) => {\r\n    try {\r\n      const id = insertRecord(record)\r\n      return { success: true, data: { id } }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Êõ¥Êñ∞ËÆ∞ÂΩïÔºà‰ΩøÁî®‰∫ãÂä°Á°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºâ\r\n  ipcMain.handle('db:updateRecord', (_, record: Record) => {\r\n    const db = getDatabase()\r\n    try {\r\n      // ‰ΩøÁî®‰∫ãÂä°Á°Æ‰øùÊìç‰ΩúÂéüÂ≠êÊÄß\r\n      const transaction = db.transaction(() => {\r\n        // ÂÖàËé∑ÂèñÊóßËÆ∞ÂΩïÁî®‰∫éÂéÜÂè≤ËÆ∞ÂΩï\r\n        const oldRecord = getRecordById(record.Id!)\r\n        if (oldRecord) {\r\n          insertHistory({\r\n            RecordId: record.Id!,\r\n            GuestName: oldRecord.GuestName,\r\n            Amount: oldRecord.Amount,\r\n            ItemDescription: oldRecord.ItemDescription,\r\n            PaymentType: oldRecord.PaymentType,\r\n            Remark: oldRecord.Remark,\r\n            NewGuestName: record.GuestName,\r\n            NewAmount: record.Amount,\r\n            NewItemDescription: record.ItemDescription,\r\n            NewPaymentType: record.PaymentType,\r\n            NewRemark: record.Remark,\r\n            OperationType: 'UPDATE',\r\n            UpdateBy: 'System',\r\n            ChangeDesc: 'Êõ¥Êñ∞ËÆ∞ÂΩï'\r\n          })\r\n        }\r\n        updateRecord(record)\r\n      })\r\n\r\n      transaction()\r\n      return { success: true }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ËΩØÂà†Èô§ËÆ∞ÂΩïÔºà‰ΩøÁî®‰∫ãÂä°Á°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºâ\r\n  ipcMain.handle('db:softDeleteRecord', (_, id: number) => {\r\n    const db = getDatabase()\r\n    try {\r\n      // ‰ΩøÁî®‰∫ãÂä°Á°Æ‰øùÊìç‰ΩúÂéüÂ≠êÊÄß\r\n      const transaction = db.transaction(() => {\r\n        // ÂÖàËé∑ÂèñÊóßËÆ∞ÂΩïÁî®‰∫éÂéÜÂè≤ËÆ∞ÂΩï\r\n        const oldRecord = getRecordById(id)\r\n        if (oldRecord) {\r\n          insertHistory({\r\n            RecordId: id,\r\n            GuestName: oldRecord.GuestName,\r\n            Amount: oldRecord.Amount,\r\n            ItemDescription: oldRecord.ItemDescription,\r\n            PaymentType: oldRecord.PaymentType,\r\n            Remark: oldRecord.Remark,\r\n            NewGuestName: null,\r\n            NewAmount: null,\r\n            NewItemDescription: null,\r\n            NewPaymentType: null,\r\n            NewRemark: null,\r\n            OperationType: 'DELETE',\r\n            UpdateBy: 'System',\r\n            ChangeDesc: 'Âà†Èô§ËÆ∞ÂΩï'\r\n          } as any)\r\n        }\r\n        softDeleteRecord(id)\r\n      })\r\n\r\n      transaction()\r\n      return { success: true }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñËÆ∞ÂΩïÂéÜÂè≤\r\n  ipcMain.handle('db:getRecordHistory', (_, recordId: number) => {\r\n    try {\r\n      return { success: true, data: getRecordHistory(recordId) }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩï\r\n  ipcMain.handle('db:getAllRecordHistory', () => {\r\n    try {\r\n      return { success: true, data: getAllRecordHistory() }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ\r\n  ipcMain.handle('db:getStatistics', () => {\r\n    try {\r\n      return { success: true, data: getStatistics() }\r\n    } catch (error) {\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÁîüÊàê PDF\r\n  ipcMain.handle('app:generatePDF', async (_, data: {\r\n    records: any[],\r\n    appName: string,\r\n    exportDate: string,\r\n    theme?: {\r\n      primary?: string\r\n      paper?: string\r\n      textPrimary?: string\r\n      accent?: string\r\n    }\r\n  }) => {\r\n    try {\r\n      // Â§ÑÁêÜ records Êï∞ÁªÑÔºåÁ°Æ‰øùÂÖ∂‰∏≠ÁöÑÊØè‰∏™ÂØπË±°Âè™ÂåÖÂê´ÂèØÂ∫èÂàóÂåñÁöÑÂ±ûÊÄß\r\n      const serializableData = {\r\n        ...data,\r\n        records: data.records.map((record: any) => ({\r\n          guestName: record.guestName,\r\n          amount: record.amount,\r\n          amountChinese: record.amountChinese,\r\n          itemDescription: record.itemDescription,\r\n          paymentType: record.paymentType,\r\n          remark: record.remark\r\n        }))\r\n      }\r\n\r\n      // ÂàõÂª∫ÈöêËóèÁöÑÊâìÂç∞Á™óÂè£\r\n      const printWindow = new BrowserWindow({\r\n        width: 1200,\r\n        height: 800,\r\n        show: false,\r\n        webPreferences: {\r\n          nodeIntegration: true,\r\n          contextIsolation: false\r\n        }\r\n      })\r\n\r\n      // Á≠âÂæÖÈ°µÈù¢Âä†ËΩΩÂÆåÊàêÂπ∂Ê∏≤Êüì\r\n      await new Promise<void>((resolve, reject) => {\r\n        const timeout = setTimeout(() => {\r\n          reject(new Error('ÊâìÂç∞È°µÈù¢Âä†ËΩΩË∂ÖÊó∂'))\r\n        }, 10000)\r\n\r\n        ipcMain.once('print-window-loaded', () => {\r\n          try {\r\n            // ÂèëÈÄÅÊï∞ÊçÆÂà∞ÊâìÂç∞Á™óÂè£\r\n            printWindow.webContents.send('render-giftbook', serializableData)\r\n          } catch (error) {\r\n            console.error('ÂèëÈÄÅÊï∞ÊçÆÂà∞ÊâìÂç∞Á™óÂè£Â§±Ë¥•:', error)\r\n            reject(new Error('ÂèëÈÄÅÊï∞ÊçÆÂà∞ÊâìÂç∞Á™óÂè£Â§±Ë¥•: ' + (error as Error).message))\r\n          }\r\n        })\r\n\r\n        ipcMain.once('print-ready', () => {\r\n          clearTimeout(timeout)\r\n          resolve()\r\n        })\r\n\r\n        // Âä†ËΩΩÊâìÂç∞È°µÈù¢\r\n        const printPagePath = path.join(process.env.VITE_PUBLIC as string, 'print.html')\r\n        printWindow.loadFile(printPagePath).catch(reject)\r\n      })\r\n\r\n      // Á≠âÂæÖÂ≠ó‰ΩìÊ∏≤Êüì\r\n      await new Promise(resolve => setTimeout(resolve, 500))\r\n\r\n      // ÁîüÊàê PDF\r\n      const pdfBuffer = await printWindow.webContents.printToPDF({\r\n        margins: {\r\n          top: 0,\r\n          bottom: 0,\r\n          left: 0,\r\n          right: 0,\r\n        },\r\n        printBackground: true,\r\n        landscape: true,\r\n        pageSize: 'A4'\r\n      })\r\n\r\n      // ÂÖ≥Èó≠ÊâìÂç∞Á™óÂè£\r\n      printWindow.close()\r\n\r\n      // ÊòæÁ§∫‰øùÂ≠òÂØπËØùÊ°Ü\r\n      const { filePath } = await dialog.showSaveDialog({\r\n        title: '‰øùÂ≠ò PDF',\r\n        defaultPath: `Á§ºÈáëÁ∞ø_${serializableData.exportDate.replace(/[Âπ¥ÊúàÊó•]/g, '')}.pdf`,\r\n        filters: [\r\n          { name: 'PDF Êñá‰ª∂', extensions: ['pdf'] }\r\n        ]\r\n      })\r\n\r\n      if (filePath) {\r\n        fs.writeFileSync(filePath, pdfBuffer)\r\n        return { success: true, filePath }\r\n      } else {\r\n        return { success: false, error: 'Áî®Êà∑ÂèñÊ∂à‰øùÂ≠ò' }\r\n      }\r\n    } catch (error) {\r\n      console.error('ÁîüÊàê PDF Â§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ==================== ÂêØÂä®È°µÁõ∏ÂÖ≥ IPC Â§ÑÁêÜÂô® ====================\r\n\r\n  // ÊâìÂºÄÊï∞ÊçÆÂ∫ìÊñá‰ª∂ÂØπËØùÊ°Ü\r\n  ipcMain.handle('electron:openDatabaseFile', async () => {\r\n    try {\r\n      const { filePaths } = await dialog.showOpenDialog({\r\n        title: 'ÈÄâÊã©Á§ºÈáëÁ∞øÊï∞ÊçÆÊñá‰ª∂',\r\n        defaultPath: dataDir,\r\n        filters: [\r\n          { name: 'Êï∞ÊçÆÂ∫ìÊñá‰ª∂', extensions: ['db'] },\r\n          { name: 'ÊâÄÊúâÊñá‰ª∂', extensions: ['*'] }\r\n        ],\r\n        properties: ['openFile']\r\n      })\r\n\r\n      if (filePaths && filePaths.length > 0) {\r\n        return { success: true, filePath: filePaths[0] }\r\n      } else {\r\n        return { success: false, error: 'Áî®Êà∑ÂèñÊ∂àÈÄâÊã©' }\r\n      }\r\n    } catch (error) {\r\n      console.error('ÊâìÂºÄÊñá‰ª∂ÂØπËØùÊ°ÜÂ§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÂàõÂª∫Êñ∞Êï∞ÊçÆÂ∫ì\r\n  ipcMain.handle('electron:createNewDatabase', async (_, fileName: string) => {\r\n    try {\r\n      // ÂÖ≥Èó≠ÂΩìÂâçÊï∞ÊçÆÂ∫ìËøûÊé•\r\n      closeDatabase()\r\n\r\n      // ÁîüÊàêÊñ∞Êï∞ÊçÆÂ∫ìË∑ØÂæÑ\r\n      const newDbPath = path.join(dataDir, fileName)\r\n      \r\n      // Â¶ÇÊûúÊñá‰ª∂Â∑≤Â≠òÂú®ÔºåÊ∑ªÂä†Â∫èÂè∑\r\n      let finalPath = newDbPath\r\n      let counter = 1\r\n      while (fs.existsSync(finalPath)) {\r\n        const ext = path.extname(fileName)\r\n        const base = path.basename(fileName, ext)\r\n        finalPath = path.join(dataDir, `${base}_${counter}${ext}`)\r\n        counter++\r\n      }\r\n\r\n      // Êõ¥Êñ∞ÂΩìÂâçÊï∞ÊçÆÂ∫ìË∑ØÂæÑ\r\n      currentDbPath = finalPath\r\n\r\n      // ÈáçÊñ∞ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìÔºà‰ºöÂàõÂª∫Êñ∞Êñá‰ª∂Ôºâ\r\n      initDatabase()\r\n\r\n      return { success: true, filePath: finalPath }\r\n    } catch (error) {\r\n      console.error('ÂàõÂª∫Êñ∞Êï∞ÊçÆÂ∫ìÂ§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ÂàáÊç¢Êï∞ÊçÆÂ∫ì\r\n  ipcMain.handle('electron:switchDatabase', async (_, filePath: string) => {\r\n    try {\r\n      // Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®\r\n      if (!fs.existsSync(filePath)) {\r\n        return { success: false, error: 'Êï∞ÊçÆÂ∫ìÊñá‰ª∂‰∏çÂ≠òÂú®' }\r\n      }\r\n\r\n      // ÂÖ≥Èó≠ÂΩìÂâçÊï∞ÊçÆÂ∫ìËøûÊé•\r\n      closeDatabase()\r\n\r\n      // Êõ¥Êñ∞ÂΩìÂâçÊï∞ÊçÆÂ∫ìË∑ØÂæÑ\r\n      currentDbPath = filePath\r\n\r\n      // ÈáçÊñ∞ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\n      initDatabase()\r\n\r\n      return { success: true }\r\n    } catch (error) {\r\n      console.error('ÂàáÊç¢Êï∞ÊçÆÂ∫ìÂ§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // ‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆÂ∫ìÔºàÈáçÂëΩÂêçÔºâ\r\n  ipcMain.handle('electron:saveCurrentDatabase', async (_, fileName: string) => {\r\n    try {\r\n      if (!currentDbPath || !fs.existsSync(currentDbPath)) {\r\n        return { success: false, error: 'ÂΩìÂâçÊ≤°ÊúâÂèØ‰øùÂ≠òÁöÑÊï∞ÊçÆ' }\r\n      }\r\n\r\n      // ÁîüÊàêÊñ∞Ë∑ØÂæÑ\r\n      const newPath = path.join(dataDir, fileName)\r\n\r\n      // Â¶ÇÊûúÊñ∞Ë∑ØÂæÑ‰∏éÂΩìÂâçË∑ØÂæÑ‰∏çÂêåÔºåÂàôÈáçÂëΩÂêç\r\n      if (newPath !== currentDbPath) {\r\n        // Â¶ÇÊûúÁõÆÊ†áÊñá‰ª∂Â∑≤Â≠òÂú®ÔºåÊ∑ªÂä†Â∫èÂè∑\r\n        let finalPath = newPath\r\n        let counter = 1\r\n        while (fs.existsSync(finalPath)) {\r\n          const ext = path.extname(fileName)\r\n          const base = path.basename(fileName, ext)\r\n          finalPath = path.join(dataDir, `${base}_${counter}${ext}`)\r\n          counter++\r\n        }\r\n\r\n        // ÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•\r\n        closeDatabase()\r\n\r\n        // ÈáçÂëΩÂêçÊñá‰ª∂\r\n        fs.renameSync(currentDbPath, finalPath)\r\n\r\n        // Êõ¥Êñ∞ÂΩìÂâçË∑ØÂæÑ\r\n        currentDbPath = finalPath\r\n\r\n        // ÈáçÊñ∞ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\n        initDatabase()\r\n\r\n        return { success: true, filePath: finalPath }\r\n      }\r\n\r\n      return { success: true, filePath: currentDbPath }\r\n    } catch (error) {\r\n      console.error('‰øùÂ≠òÊï∞ÊçÆÂ∫ìÂ§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n\r\n  // Ëé∑ÂèñÊúÄËøëÊâìÂºÄÁöÑÊï∞ÊçÆÂ∫ìÂàóË°®\r\n  ipcMain.handle('electron:getRecentDatabases', async () => {\r\n    try {\r\n      // Êâ´ÊèèÊï∞ÊçÆÁõÆÂΩï‰∏≠ÁöÑÊâÄÊúâ .db Êñá‰ª∂\r\n      const files = fs.readdirSync(dataDir)\r\n      const dbFiles = files\r\n        .filter(file => file.endsWith('.db'))\r\n        .map(file => {\r\n          const filePath = path.join(dataDir, file)\r\n          const stats = fs.statSync(filePath)\r\n          return {\r\n            name: path.basename(file, '.db'),\r\n            path: filePath,\r\n            lastOpened: stats.mtime.toISOString()\r\n          }\r\n        })\r\n        .sort((a, b) => new Date(b.lastOpened).getTime() - new Date(a.lastOpened).getTime())\r\n\r\n      return { success: true, recentDatabases: dbFiles }\r\n    } catch (error) {\r\n      console.error('Ëé∑ÂèñÊúÄËøëÊï∞ÊçÆÂ∫ìÂàóË°®Â§±Ë¥•:', error)\r\n      return { success: false, error: (error as Error).message }\r\n    }\r\n  })\r\n}\r\n\r\n// Quit when all windows are closed, except on macOS. There, it's common\r\n// for applications and their menu bar to stay active until the user quits\r\n// explicitly with Cmd + Q.\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') {\r\n    closeDatabase()\r\n    app.quit()\r\n    win = null\r\n  }\r\n})\r\n\r\napp.on('activate', () => {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (BrowserWindow.getAllWindows().length === 0) {\r\n    createWindow()\r\n  }\r\n})\r\n\r\napp.whenReady().then(() => {\r\n  try {\r\n    // ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ì\r\n    initDatabase()\r\n    console.log('Database initialized successfully')\r\n  } catch (error) {\r\n    console.error('Failed to initialize database:', error)\r\n  }\r\n  // ËÆæÁΩÆ IPC Â§ÑÁêÜÂô®\r\n  setupIpcHandlers()\r\n  // ÂàõÂª∫Á™óÂè£\r\n  createWindow()\r\n})\r\n"],"names":["db","__filename","__dirname"],"mappings":"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"}