# 电子礼金簿项目代码修复计划

## 第一阶段：高优先级修复（安全与稳定性）

### 1. 修复 App.vue 定时器内存泄漏
**文件**: `src/App.vue`
**修改内容**:
- 在 `script setup` 中添加 `intervalId` 引用
- 在 `onUnmounted` 钩子中清理定时器

### 2. 移除 preload.ts 中不必要的 IPC 暴露
**文件**: `electron/preload.ts`
**修改内容**:
- 删除 `ipcRenderer` 对象的暴露
- 只保留 `db` API 的暴露

### 3. 加强错误处理
**文件**: `src/App.vue`, `src/components/RecordForm.vue`, `src/components/RecordList.vue`
**修改内容**:
- 将所有 `console.error` 改为用户友好的提示（使用 alert 或自定义 Toast）
- 在数据库操作失败时给用户明确反馈

### 4. 添加数据库事务支持
**文件**: `electron/main.ts`, `electron/database.ts`
**修改内容**:
- 在更新和删除操作中使用 better-sqlite3 的事务功能
- 确保查询旧记录→插入历史记录→执行操作的原子性

---

## 第二阶段：中优先级优化（代码质量与性能）

### 5. 创建共享常量文件
**新文件**: `src/constants/index.ts`
**内容**:
- 定义 `PaymentType` 枚举
- 导出 `paymentTypeMap` 对象
- 定义其他共享常量

**修改文件**: `RecordForm.vue`, `RecordList.vue`
- 移除本地定义的 `paymentTypes`，改为导入共享常量

### 6. 优化性能问题
**文件**: `src/App.vue`
- 将组件引用从 `ref` 改为 `shallowRef`

**文件**: `src/components/RecordList.vue`
- 优化 `paginatedRecords` 计算属性，避免每页都反转数组

**文件**: `src/components/RecordForm.vue`
- 优化金额转换逻辑，使用 debounce 减少重复计算

### 7. 删除未使用文件和清理样式
**删除文件**: `src/components/HelloWorld.vue`
**修改文件**: `src/style.css`
- 清理与 `theme.css` 冲突的样式
- 或完全删除 `style.css`（如果所有样式已由 theme.css 覆盖）

---

## 第三阶段：低优先级完善

### 8. 更新 electron-builder 配置
**文件**: `electron-builder.json5`
**修改内容**:
- 将 `appId` 改为 `"com.yourcompany.electron-gift-book"`
- 将 `productName` 改为 `"电子礼金簿"`

### 9. 修复其他功能缺陷
**文件**: `src/components/RecordList.vue`
- 添加右键菜单边界检查，防止菜单显示在可视区域外

**文件**: `src/App.vue`
- 暂时隐藏未实现的导入/导出按钮，或添加提示

---

## 预期效果

修复后代码质量评分预期提升：
| 维度 | 当前 | 预期 |
|------|------|------|
| 功能完整性 | 7/10 | 8/10 |
| 代码质量 | 6/10 | 8/10 |
| 性能 | 6/10 | 8/10 |
| 安全性 | 5/10 | 8/10 |
| 可维护性 | 7/10 | 8/10 |
| **总体** | **6.2/10** | **8.0/10** |

---

请确认此修复计划后，我将开始执行具体的代码修改。