# 电子礼金开发步骤

我将整个开发过程拆解为 **7 个标准步骤（Steps）**。你只需要按照顺序，将对应的 **"AI 指令 (Prompt)"** 复制给 AI 工具即可。

------

### ⚠️ 开发前置准备

1. **安装 Node.js:** 确保版本 >= 18.0。
2. **新建文件夹:** 命名为 `GiftBook-Electron`，在该目录下打开 VS Code / Cursor。
3. **打开终端:** 准备输入命令。

------

### Step 1: 项目初始化 (Init & Infrastructure)

**目标：** 搭建 Electron + Vue 3 + TypeScript + Tailwind 环境。

```markdown
Role: Expert Electron & Vue Developer.
Task: Initialize a new project for a desktop application.

Requirements:
1. Framework: Electron + Vue 3 (Vite) + TypeScript.
2. Styling: Install and configure Tailwind CSS.
3. Architecture: Set up the standard Electron folder structure (Main process in `electron/`, Renderer in `src/`).
4. Package Manager: Use `npm`.

Action:
- Please verify the environment and provide the necessary terminal commands to scaffold the project.
- Configure `vite.config.ts` to work with Electron.
- Create a simple "Hello World" main window to ensure the app runs.
```

------

### Step 2: 数据库层搭建 (Database Layer)

**目标：** 配置 `better-sqlite3` 并建立数据表。

**AI 指令 (Prompt):**

~~~markdown
Task: Set up the local database using `better-sqlite3`.

1. Install `better-sqlite3`. Note: Since this is an Electron app, ensure we handle the native module rebuilding or configuration correctly in `vite.config.ts` or `electron-builder`.
2. Create a file `electron/db/db-service.ts`.
3. Implement a class `DBService` that initializes the SQLite database file `giftbook.db` in the user's `userData` directory.
4. On initialization, execute the following SQL to create tables if they don't exist:

```sql
CREATE TABLE IF NOT EXISTS Records (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    GuestName TEXT NOT NULL,
    Amount DECIMAL(10, 2) NOT NULL DEFAULT 0,
    AmountChinese TEXT,
    ItemDescription TEXT,
    PaymentType INTEGER DEFAULT 0, -- 0:Cash, 1:WeChat, 2:Internal
    Remark TEXT,
    CreateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted INTEGER DEFAULT 0
);

CREATE TABLE IF NOT EXISTS Records_History (
    HistoryId INTEGER PRIMARY KEY AUTOINCREMENT,
    RecordId INTEGER NOT NULL,
    GuestName TEXT NOT NULL,
    Amount DECIMAL(10, 2),
    ItemDescription TEXT,
    PaymentType INTEGER,
    Remark TEXT,
    UpdateBy TEXT DEFAULT 'System',
    UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    ChangeDesc TEXT,
    FOREIGN KEY (RecordId) REFERENCES Records(Id)
);
~~~

1. Export an instance of this service.

~~~Markdown
---

### Step 3: 后端 API 开发 (IPC Handlers)
**目标：** 让前端能通过 Electron 的 IPC 机制调用数据库。

**AI 指令 (Prompt):**
```markdown
Task: Create IPC Handlers for Database CRUD operations.

1. In the Main process (`electron/main.ts` or a separate `ipc-handlers.ts`), create handlers for:
   - `get-all-records`: Select all from Records where IsDeleted = 0.
   - `add-record`: Insert a new record.
   - `update-record`: Update a record (and automatically Insert a log into Records_History before updating).
   - `delete-record`: Soft delete (set IsDeleted = 1).
   - `search-records`: Fuzzy search by GuestName or Remark.
   
2. Expose these functions via `preload.ts` using `contextBridge` so the Vue renderer can call them safely (e.g., `window.api.getRecords()`).
3. Define TypeScript interfaces for the Record and History models in a shared `types.ts` file.
~~~

------

### Step 4: 核心 UI - 竖排网格组件 (Vertical Grid UI)

**目标：** 实现“所见即所得”的竖排编辑界面。**这是最难的一步。**

**AI 指令 (Prompt):**

```markdown
Task: Create the core "Vertical Book" component in Vue.

Requirements:
1. Component Name: `VerticalGiftBook.vue`.
2. Layout: Use CSS Grid.
   - The container must use `writing-mode: vertical-rl` (Text runs top-to-bottom, lines progress right-to-left).
   - The grid should look like a traditional Chinese ledger (visible borders, red/paper texture background).
3. Data Structure: The grid represents a list of `Records`.
   - Columns: Each Guest is a column.
   - Rows: Field types (GuestName, Remark, PaymentType, AmountChinese).
4. Interaction (WYSIWYG):
   - Display state: Shows text in a calligraphic font.
   - Edit state: Clicking a cell turns it into an `<input>` or `<textarea>`.
   - The Input must handle vertical text input correctly (or use a transparent horizontal input overlay if vertical input is buggy).
5. Visuals:
   - Use Tailwind CSS for styling.
   - Add a "New Record" placeholder column on the far left.

Action: Create the Vue component with Mock Data first to test the CSS layout.
```

------

### Step 5: 业务逻辑与交互 (Logic & Navigation)

**目标：** 键盘流、金额转大写、支付方式标记。

**AI 指令 (Prompt):**

```Markdown
Task: Implement business logic and keyboard navigation for `VerticalGiftBook.vue`.

1. **Utils**: Create a utility function `digitToChinese(n: number)` that converts 1000 -> "壹仟元整".
2. **Keyboard Nav**:
   - `Tab` or `Arrow Down`: Move focus to the next field in the same column (Name -> Remark -> Amount).
   - `Enter` on Amount field: 
     a. Trigger save (call `window.api.addRecord` or `updateRecord`).
     b. Move focus to the "GuestName" field of the *next* column (Create a new column on the left if needed).
3. **Data Binding**:
   - When user types "1000" in the Amount field, automatically generate the Chinese string for the display.
4. **Payment Type**:
   - Implement a context menu (Right-click) or a toggle button on the cell to set `PaymentType` (0, 1, 2).
   - Visual: Add a "Stamp" effect (CSS) like a red circle with "微" for WeChat or "内" for Internal payment on top of the cell.
```

------

### Step 6: 状态栏与仪表盘 (Toolbar & Dashboard)

**目标：** 完成顶部工具栏和底部统计。

**AI 指令 (Prompt):**

```Markdown
Task: Build the Toolbar and Info Dashboard.

1. **Toolbar Component**:
   - Title Input: Editable title (e.g., "Zhang Family Wedding").
   - Buttons: Export Excel, Export PDF, Search Input.
   - Lunar Date: Use a library (like `lunar-javascript`) to display today's lunar date.

2. **Info Dashboard (Footer/Sidebar)**:
   - Display calculated stats: Total Headcount, Total Amount.
   - Breakdown: Cash Total, WeChat Total.
   - Privacy Toggle: Add an "Eye" icon. When closed, replace numbers with `****`.

3. **Integration**: Connect the search bar to filter the data in the `VerticalGiftBook` component.
```

------

### Step 7: 导出与打包 (Export & Build)

**目标：** 导出功能及最终打包。

**AI 指令 (Prompt):**

```Markdown
Task: Implement Export features and Build config.

1. **Excel Export**:
   - Use `xlsx` library.
   - Create a function to format the current data into a standard row-based Excel sheet and trigger download.

2. **PDF Export**:
   - Use `jspdf` and `html2canvas`.
   - Goal: Capture the visual look of the "Vertical Gift Book" as an image/PDF page. 
   - Note: Ensure the "Red Paper" background is preserved.

3. **Build**:
   - Configure `electron-builder` in `package.json` for Windows target (`nsis`).
   - Add an icon configuration.

Action: Provide the code for the export service and the build script updates.
```

------

### 给你的建议 (Pro Tips)

1. **分步提交 (Git Commit):** 每完成一个 Step，验证无误后，记得提交代码。这样如果 AI 下一步写乱了，你可以随时回滚。
2. **样式微调:** 竖排（Vertical-rl）在不同的浏览器内核渲染可能有细微差异。如果发现输入框光标位置不对，可以让 AI **"使用绝对定位覆盖法 (Absolute Position Overlay)"** 来解决输入框对齐问题。
3. **图标资源:** 让 AI 使用 `lucide-vue-next` 或类似的库来快速生成图标（如微信图标、眼睛图标）。
4. **调试 IPC:** 如果数据存不进去，第一时间检查 `main.ts` 的控制台输出（Electron 的后端日志）。