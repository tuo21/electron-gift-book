# 电子礼金簿详细功能需求v2

### 第一部分：技术方案确认

针对“竖排展示”和“AI辅助开发”这两个核心点，采用以下技术栈。

#### Electron + Vue 3 + TypeScript + SQLite

- **应用框架：** **Electron** (主进程管理窗口和系统文件，渲染进程负责界面)
- **前端框架：** **Vue 3 (Composition API) + Vite**
- **语言：** **TypeScript** (AI 对强类型的代码生成准确率远高于 JavaScript)
- **UI 样式：** **Tailwind CSS** (配合 CSS 变量实现换肤，`writing-mode: vertical-rl` 处理竖排)
- **数据库：** **Better-SQLite3** 本地数据库
- **导出库：** `jspdf` (PDF导出) + `xlsx` (Excel导出)

### 第二部分：电子礼金簿 - 产品需求文档 (PRD)

#### 1. 项目概述

一款运行于 Windows 平台的电子礼金登记工具。旨在用高效的电子录入替代手写，同时通过 CSS 技术完美复刻传统礼金簿的“竖排红纸黑字”视觉体验，兼顾仪式感与实用性。

#### 1. 界面布局 (UI Layout)

- **整体视觉：** 界面分为“工具栏”“主操作区”和“信息展示区”。
  - 工具栏：由标题、操作按钮（导出、导入、修改记录、统计信息、搜索）、农历信息组成
  - 屏幕主操作区就是一本打开的红宣纸账簿。
  - 信息展示区展示信息概览，由人数、总金额、内收、现金、微信组成，增加显隐开关，默认星号隐藏。
- **网格系统：** 界面由隐形的网格组成（Grid Layout）。
  - **列（Column）：** 代表“一页”或“一列数据”。
  - **行（Row）：** 对应每一个字段（姓名、备注、金额、小写金额、支付方式备注）。
- **操作逻辑：**
  - **默认状态：** 空白模版。
  - **编辑状态：** 点击任意文字或空白格，该位置变为“竖排输入框”，光标闪烁。
  - **新增记录：** 点击最左侧的空白列，自动初始化一条新记录。

#### 2. 交互细节 (UX Flow)

- **键盘流（核心）：**
  - `Tab` / `↓`：输入完姓名，跳到下方的金额。
  - `Enter`：确认当前输入。如果是“金额”栏回车，自动保存整条，并跳转到下一列的“姓名”栏（**光标向右上方移动**，符合现代人阅读书写逻辑）。
- **智能辅助：**
  - **金额输入：** 在输入框输入 `1000`，光标离开后，界面上自动显示为 `壹仟圆整`（存库时同时存 1000 和中文）。
  - **支付方式切换：** 既然没有下拉框，建议使用**右键菜单**或**快捷键**（如 F1 现金, F2 微信）来改变该格子的背景色标记（例如：微信支付的金额盖一个红色的“微”字印章）。
- **主题换肤：** 预设“喜宴红”、“丧仪白”、“寿宴金”等主题，一键切换背景图和字体颜色。

#### 3. 功能详细说明

| **模块**     | **功能点** | **详细描述**                                     | **逻辑/规则**                                                |
| ------------ | ---------- | ------------------------------------------------ | ------------------------------------------------------------ |
| **基础设置** | 项目设置   | 设定当前办事标题（如“张府婚宴”）、日期、记账人。 | 标题将打印/显示在导出文件的头部。                            |
|              | 风格选择   | 选择皮肤（红/白/自定义）。                       | 修改 CSS 全局变量。                                          |
| **数据录入** | 快捷录入   | 姓名、金额、备注、支付方式。                     | 支持拼音首字母匹配（如预制亲友名单）。                       |
|              | 金额转换   | 数字金额自动转大写中文。                         | 输入 `1000` -> 界面即时显示 `壹仟元`。                       |
|              | 支付标记   | 标记资金来源。                                   | 可点击切换，选项：现金(0)、微信(1)、内收/抵账(2)。默认为现金。 |
|              | 自动保存   | 每次回车确认后立即写入数据库。                   | 防止断电丢失数据。                                           |
| **数据展示** | 竖排列表   | 传统的名单展示方式。                             | 每页显示固定条数，支持左右翻页动画。                         |
|              | 实时统计   | 底部显示：总金额、总人数、现金/微信分项统计。    | `Sum(Amount) WHERE IsDeleted=0`                              |
| **数据管理** | 检索       | 支持按姓名、备注模糊搜索。                       | 搜索结果高亮显示。                                           |
|              | 修改/软删  | 选中记录进行修改或删除。                         | 删除操作仅将 `IsDeleted` 置为 1，不物理删除。                |
|              | 修改历史   | 查看某条记录的变更日志。                         | 关联查询 `Records_History` 表。                              |
| **导入导出** | Excel 导出 | 导出完整清单。                                   | 选择字段保持，全部字段还是常规字段（序号、姓名、金额、备注、支付方式） |
|              | PDF 导出   | 导出“电子相册”级的礼金页。                       | 保持竖排格式，用于打印或微信发送给主人家。                   |
|              | 数据导入   | 从 Excel 导入历史名单。                          | 方便老旧数据迁移。                                           |

#### 4. 数据库设计 (Schema)

建议在初始化应用时执行以下 SQL：

**表 1: Records (主记录表)**

CREATE TABLE IF NOT EXISTS Records (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    GuestName TEXT NOT NULL,
    Amount DECIMAL(10, 2) NOT NULL DEFAULT 0,
    AmountChinese TEXT, -- 建议冗余存一个大写，方便导出，或仅前端转换
    ItemDescription TEXT,
    PaymentType INTEGER DEFAULT 0, -- 0:现金, 1:微信, 2:内收
    Remark TEXT,
    CreateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted INTEGER DEFAULT 0 -- 0:正常, 1:已删除
);

**表 2: Records_History (修改历史表)**

CREATE TABLE IF NOT EXISTS Records_History (
    HistoryId INTEGER PRIMARY KEY AUTOINCREMENT,
    RecordId INTEGER NOT NULL,
    GuestName TEXT NOT NULL,
    Amount DECIMAL(10, 2),
    ItemDescription TEXT,
    PaymentType INTEGER,
    Remark TEXT,
    UpdateBy TEXT DEFAULT 'System', -- 修改人，单机版默认System
    UpdateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    ChangeDesc TEXT,
    FOREIGN KEY (RecordId) REFERENCES Records(Id)
);

### 第三部分：开发进度表 (Timeline)

假设你使用 AI Coding 工具进行单人开发，预计周期为 **10~14 天**。

#### Phase 1: 框架搭建与原型

- **目标：** Hello World，数据库跑通。
- **任务：**
  1. 初始化 Electron + Vue3 + TypeScript 项目。
  2. 配置 Tailwind CSS。
  3. 配置 SQLite 环境，编写数据库初始化脚本（InitDB）。
  4. **AI 指令示例：** *"Create a Vue 3 service to handle SQLite connections using `better-sqlite3`. Include methods to initialize the tables based on this schema..."*

#### Phase 2: 核心录入功能

- **目标：** 能录入数据，能看到数据。
- **任务：**
  1. 开发左侧录入表单（姓名、金额、单选框）。
  2. 实现“数字转大写”工具函数（Utils）。
  3. 实现 CRUD（增删改查）的后端 IPC 接口。
  4. 全键盘事件监听（Enter 提交）。

#### Phase 3: 竖排展示与UI美化 

- **目标：** 看起来像个礼金簿。
- **任务：**
  1. 实现右侧展示组件：使用 CSS `writing-mode: vertical-rl`。
  2. 开发“分页逻辑”（因为竖排无法无限向下滚动，通常是向左滚动或翻页）。
  3. 集成主题切换功能（CSS 变量切换背景图和字体颜色）。

#### Phase 4: 高级功能

- **目标：** 搜索、统计、修改历史。
- **任务：**
  1. 实现模糊搜索过滤逻辑。
  2. 实现修改记录的触发器或逻辑（每次 Update 前先 Insert into History）。
  3. 顶部/底部的实时统计 Dashboard。

#### Phase 5: 导入导出与打包

- **目标：** 交付可用软件。
- **任务：**
  1. 集成 `xlsx` 库实现 Excel 导入导出。
  2. 实现 PDF 导出（将 DOM 转图片或直接生成 PDF）。
  3. 使用 `electron-builder` 打包成 Windows `.exe` 安装包。
  4. **断电保护测试：** 强制关闭应用，重启检查数据。